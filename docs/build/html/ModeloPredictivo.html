

<!DOCTYPE html>
<html class="writer-html5" lang="es" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modelos Predictivos &mdash; TFM: An√°lisis de Tendencias Econ√≥micas en Madrid mediante Modelos Financieros y de Sentimiento</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=ba61de6b"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/translations.js?v=f85f4cfb"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="√çndice" href="genindex.html" />
    <link rel="search" title="B√∫squeda" href="search.html" />
    <link rel="next" title="Evaluaci√≥n de los Modelos" href="EvaluacionModelo.html" />
    <link rel="prev" title="Datos y Preparaci√≥n" href="DatosPreparacion.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            TFM: An√°lisis de Tendencias Econ√≥micas en Madrid mediante Modelos Financieros y de Sentimiento
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ResumenEjecutivo.html">Resumen Ejecutivo</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduccion.html">Introducci√≥n</a></li>
<li class="toctree-l1"><a class="reference internal" href="DescripcionProblema.html">Descripci√≥n Problema</a></li>
<li class="toctree-l1"><a class="reference internal" href="MarcoTeorico.html">Modelos Teoricos</a></li>
<li class="toctree-l1"><a class="reference internal" href="DatosPreparacion.html">Datos y Preparaci√≥n</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modelos Predictivos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modelos-de-analisis-de-sentimiento">Modelos de an√°lisis de sentimiento</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modelo-en-ingles-mrm8488-distilroberta-finetuned-financial-news-sentiment-analysis">Modelo en ingl√©s: <em>mrm8488/distilroberta-finetuned-financial-news-sentiment-analysis</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#modelo-en-espanol-multilingue-nlptown-bert-base-multilingual-uncased-sentiment">Modelo en espa√±ol (multiling√ºe): <em>nlptown/bert-base-multilingual-uncased-sentiment</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#comparacion-y-justificacion-de-uso">Comparaci√≥n y justificaci√≥n de uso</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tabla-comparativa-de-modelos">Tabla comparativa de modelos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatizacion-del-flujo-de-trabajo-con-n8n">Automatizaci√≥n del flujo de trabajo con n8n</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id1"></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#flujo-de-utilizacion-de-los-modelos">Flujo de utilizacion de los modelos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generacion-de-las-columnas-con-tipo-de-titulos">Generacion de las columnas con tipo de titulos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analisis-de-frontera-de-eficiencia">Analisis de Frontera de eficiencia</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="EvaluacionModelo.html">Evaluaci√≥n de los Modelos</a></li>
<li class="toctree-l1"><a class="reference internal" href="Conclusiones.html">Conclusiones</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bibliografia.html">Bibliograf√≠a</a></li>
<li class="toctree-l1"><a class="reference internal" href="Anexos.html">Anexos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TFM: An√°lisis de Tendencias Econ√≥micas en Madrid mediante Modelos Financieros y de Sentimiento</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Modelos Predictivos</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/ModeloPredictivo.md.txt" rel="nofollow"> Ver c√≥digo fuente de la p√°gina</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="modelos-predictivos">
<h1>Modelos Predictivos<a class="headerlink" href="#modelos-predictivos" title="Link to this heading">ÔÉÅ</a></h1>
<section id="modelos-de-analisis-de-sentimiento">
<h2>Modelos de an√°lisis de sentimiento<a class="headerlink" href="#modelos-de-analisis-de-sentimiento" title="Link to this heading">ÔÉÅ</a></h2>
<p>Se ha decidido utilizar dos modelos predictivo en el cual los dos se utilozaron para predecir la probabilidad de que un titular sea <em>negativo, positivo o neutral</em>. los dos modelos son <code class="docutils literal notranslate"><span class="pre">bert-base-multilingual-uncased-sentiment</span></code>[multilingual] y <code class="docutils literal notranslate"><span class="pre">distilroberta-finetuned-financial-news-sentiment-analysis</span></code> [ingl√©s]. Estos dos modelos fueron seleccionados por su rendimiento en clasificaci√≥n de sentimientos y por su cobertura en distintos idiomas. Dado que las fuentes analizadas incluyen tanto medios en ingl√©s como en espa√±ol, se ha considerado necesario emplear modelos espec√≠ficos para cada idioma con el fin de maximizar la precisi√≥n de los resultados.</p>
<section id="modelo-en-ingles-mrm8488-distilroberta-finetuned-financial-news-sentiment-analysis">
<h3>Modelo en ingl√©s: <em>mrm8488/distilroberta-finetuned-financial-news-sentiment-analysis</em><a class="headerlink" href="#modelo-en-ingles-mrm8488-distilroberta-finetuned-financial-news-sentiment-analysis" title="Link to this heading">ÔÉÅ</a></h3>
<p>Este modelo corresponde a una versi√≥n ajustada de <strong>DistilRoBERTa-base</strong>, entrenada espec√≠ficamente en el conjunto de datos <em>Financial PhraseBank</em>, que contiene 4.840 frases procedentes de noticias financieras en ingl√©s. Dicho corpus fue anotado por entre 5 y 8 expertos, categorizando cada enunciado seg√∫n su polaridad de sentimiento (positivo, negativo o neutral).</p>
<p>A nivel arquitect√≥nico, DistilRoBERTa es una versi√≥n comprimida de RoBERTa-base que conserva su rendimiento con menor complejidad computacional. Consta de <strong>6 capas, 768 dimensiones y 12 cabezales de atenci√≥n</strong>, sumando un total aproximado de <strong>82 millones de par√°metros</strong> (frente a los 125 millones de RoBERTa-base). Esta reducci√≥n permite que el modelo sea, en promedio, <strong>el doble de r√°pido</strong> en comparaci√≥n con RoBERTa-base, manteniendo un desempe√±o competitivo.</p>
<p>En cuanto a resultados, el modelo alcanz√≥ un <strong>accuracy del 98,23 %</strong> y una p√©rdida de validaci√≥n de <strong>0,1116</strong> en el conjunto de evaluaci√≥n, lo que demuestra un desempe√±o sobresaliente en la clasificaci√≥n de sentimiento en el √°mbito financiero.</p>
<p>La principal ventaja de este modelo es su <strong>alta especializaci√≥n en finanzas</strong>, lo que le permite detectar matices en titulares y frases econ√≥micas con gran precisi√≥n. No obstante, presenta la limitaci√≥n de estar restringido exclusivamente al ingl√©s.</p>
<p>https://huggingface.co/mrm8488/distilroberta-finetuned-financial-news-sentiment-analysis</p>
</section>
<section id="modelo-en-espanol-multilingue-nlptown-bert-base-multilingual-uncased-sentiment">
<h3>Modelo en espa√±ol (multiling√ºe): <em>nlptown/bert-base-multilingual-uncased-sentiment</em><a class="headerlink" href="#modelo-en-espanol-multilingue-nlptown-bert-base-multilingual-uncased-sentiment" title="Link to this heading">ÔÉÅ</a></h3>
<p>Este modelo se basa en <strong>BERT multiling√ºe uncased</strong> y ha sido afinado para realizar an√°lisis de sentimiento en rese√±as de productos en seis idiomas: ingl√©s, neerland√©s, alem√°n, franc√©s, espa√±ol e italiano. La principal caracter√≠stica de este modelo es que clasifica el sentimiento en una escala de <strong>1 a 5 estrellas</strong>, en lugar de limitarse a categor√≠as binarias (positivo/negativo) o ternarias (positivo/neutral/negativo). Esto le otorga mayor capacidad para capturar matices y gradaciones en la opini√≥n expresada en los textos.</p>
<p>A nivel t√©cnico, el modelo cuenta con aproximadamente <strong>167 millones de par√°metros</strong> y conserva la arquitectura original de BERT multiling√ºe uncased, lo que significa que no diferencia entre may√∫sculas y min√∫sculas durante el procesamiento. Fue entrenado sobre un corpus de m√°s de <strong>600 000 rese√±as multiling√ºes</strong>, de las cuales <strong>50 000 corresponden al espa√±ol</strong>, garantizando un desempe√±o razonable en este idioma.</p>
<p>En cuanto a m√©tricas, el modelo presenta un rendimiento en espa√±ol de alrededor de <strong>58 % de exactitud en la predicci√≥n exacta</strong> del n√∫mero de estrellas, y una precisi√≥n de <strong>95 % cuando se permite un margen de ¬±1 estrella</strong>. Este √∫ltimo dato refleja que, aunque puede fallar en la predicci√≥n exacta de la escala, en la gran mayor√≠a de los casos logra capturar correctamente la orientaci√≥n del sentimiento (positivo, negativo o intermedio).</p>
<p>La <strong>ventaja principal</strong> de este modelo es su <strong>cobertura multiling√ºe</strong>, lo que permite procesar textos en diferentes idiomas sin necesidad de entrenar modelos independientes para cada caso. Adem√°s, la clasificaci√≥n en una escala de cinco puntos ofrece un an√°lisis m√°s granular y rico en matices, especialmente √∫til para contextos con opiniones diversas o polarizaci√≥n moderada.</p>
<p>Sin embargo, el modelo tambi√©n presenta <strong>limitaciones importantes</strong>. En primer lugar, no fue dise√±ado ni ajustado espec√≠ficamente para el <strong>dominio financiero</strong>, lo que puede reducir su capacidad de interpretar correctamente frases t√©cnicas o jergas econ√≥micas. En segundo lugar, la precisi√≥n exacta en espa√±ol se sit√∫a por debajo de otros idiomas como el ingl√©s o el alem√°n, aunque esta limitaci√≥n se mitiga al considerar la m√©trica <em>off-by-1</em>.</p>
<p>En el contexto de este trabajo, el modelo ha sido utilizado principalmente como una herramienta complementaria para el an√°lisis de textos en espa√±ol. Si bien su desempe√±o no alcanza la especializaci√≥n del modelo en ingl√©s, su flexibilidad multiling√ºe y su buena capacidad de aproximaci√≥n al sentimiento general lo convierten en una opci√≥n adecuada para garantizar cobertura en medios hispanohablantes.</p>
<p>https://huggingface.co/nlptown/bert-base-multilingual-uncased-sentiment</p>
</section>
<section id="comparacion-y-justificacion-de-uso">
<h3>Comparaci√≥n y justificaci√≥n de uso<a class="headerlink" href="#comparacion-y-justificacion-de-uso" title="Link to this heading">ÔÉÅ</a></h3>
<p>La principal diferencia entre ambos modelos radica en su <strong>especializaci√≥n</strong>. El modelo en ingl√©s ofrece un mejor desempe√±o en el contexto financiero gracias a su ajuste en noticias econ√≥micas, mientras que el modelo en espa√±ol, aunque m√°s generalista, permite cubrir de manera efectiva los textos en este idioma. En conjunto, la combinaci√≥n de ambos modelos garantiza un an√°lisis m√°s robusto y equilibrado de noticias financieras procedentes de distintas fuentes y en diferentes idiomas.</p>
</section>
<hr class="docutils" />
<section id="tabla-comparativa-de-modelos">
<h3>Tabla comparativa de modelos<a class="headerlink" href="#tabla-comparativa-de-modelos" title="Link to this heading">ÔÉÅ</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Modelo</p></th>
<th class="head"><p>Idioma(s)</p></th>
<th class="head"><p>Ventajas</p></th>
<th class="head"><p>Limitaciones</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>mrm8488/distilroberta-finetuned-financial-news-sentiment-analysis</em></p></td>
<td><p>Ingl√©s</p></td>
<td><p>Especializado en noticias financieras, mayor precisi√≥n en este dominio.</p></td>
<td><p>Solo aplica a textos en ingl√©s.</p></td>
</tr>
<tr class="row-odd"><td><p><em>nlptown/bert-base-multilingual-uncased-sentiment</em></p></td>
<td><p>Multiling√ºe (incluye espa√±ol)</p></td>
<td><p>Cobertura en m√°s de 100 idiomas, adecuado para an√°lisis en espa√±ol.</p></td>
<td><p>No especializado en finanzas, menor precisi√≥n contextual.</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="automatizacion-del-flujo-de-trabajo-con-n8n">
<h3>Automatizaci√≥n del flujo de trabajo con n8n<a class="headerlink" href="#automatizacion-del-flujo-de-trabajo-con-n8n" title="Link to this heading">ÔÉÅ</a></h3>
<p>En la automatizaci√≥n de la ingesta y el procesamiento de datos se ha empleado <strong>n8n</strong>, una herramienta de <em>workflow automation</em> de c√≥digo abierto. Su funci√≥n principal es permitir la integraci√≥n entre m√∫ltiples servicios, APIs y bases de datos mediante la creaci√≥n de flujos de trabajo visuales que se ejecutan de manera autom√°tica en funci√≥n de determinados eventos o programaciones. A partir del trigger que en nuestro caso de de tiempo (00:00 todos los dias), los nodos se van ejecutando en orden l√≥gico, permitiendo que la informaci√≥n fluya autom√°ticamente entre servicios sin intervenci√≥n manual.</p>
<p>En conjunto, n8n se convierte en un componente clave para la <strong>orquestaci√≥n de datos</strong> en este proyecto, permitiendo que el an√°lisis de sentimiento y financiero se sustente en informaci√≥n</p>
</section>
</section>
<section id="id1">
<h2><img alt="FlujoN8N" src="_images/FlujoN8N.jpeg" /><a class="headerlink" href="#id1" title="Link to this heading">ÔÉÅ</a></h2>
<section id="flujo-de-utilizacion-de-los-modelos">
<h3>Flujo de utilizacion de los modelos<a class="headerlink" href="#flujo-de-utilizacion-de-los-modelos" title="Link to this heading">ÔÉÅ</a></h3>
<p>Dentro del <em>datalake</em> definido en el m√≥dulo de <strong>Datos y Preparaci√≥n</strong>, se encuentra la tabla unificada denominada <code class="docutils literal notranslate"><span class="pre">TODOS_TITULARES</span></code>. A partir de esta base de datos se extraen los titulares procedentes de los distintos noticieros. Posteriormente, mediante un <strong>√°rbol de decisi√≥n</strong> se determina el idioma de cada titular (ingl√©s o espa√±ol). Seg√∫n el resultado, se aplica el modelo de predicci√≥n correspondiente, previamente entrenado para el an√°lisis de sentimiento en cada idioma.</p>
<p>CODIFO DE MARCO PERU</p>
</section>
<hr class="docutils" />
<section id="generacion-de-las-columnas-con-tipo-de-titulos">
<h3>Generacion de las columnas con tipo de titulos<a class="headerlink" href="#generacion-de-las-columnas-con-tipo-de-titulos" title="Link to this heading">ÔÉÅ</a></h3>
<p>Una vez aplicados los modelos de an√°lisis de sentimiento, se generan cuatro variables principales: <code class="docutils literal notranslate"><span class="pre">SENTIMIENTO_RESULTADO</span></code>, <code class="docutils literal notranslate"><span class="pre">PROBABILIDAD_POSITIVO</span></code>, <code class="docutils literal notranslate"><span class="pre">PROBABILIDAD_NEGATIVA</span></code> y <code class="docutils literal notranslate"><span class="pre">PROBABILIDAD_NEUTRAL</span></code>. Estas variables permiten determinar de manera objetiva la clasificaci√≥n final del texto en funci√≥n de su polaridad. Posteriormente, los resultados se incorporan a la tabla principal de <strong>Noticias_Analizadas</strong> y se almacenan nuevamente en Snowflake, lo que garantiza su disponibilidad para futuros an√°lisis, tanto de car√°cter t√©cnico como de integraci√≥n con otros indicadores financieros.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>FECHA</p></th>
<th class="head"><p>TITULAR</p></th>
<th class="head"><p>FUENTE</p></th>
<th class="head"><p>SENTIMIENTO_RESULTADO</p></th>
<th class="head"><p>PROBABILIDAD_POSITIVO</p></th>
<th class="head"><p>PROBABILIDAD_NEUTRAL</p></th>
<th class="head"><p>PROBABILIDAD_POSITIVO</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2024-02-27</p></td>
<td><p>Felipe VI pide que los avances tecnol√≥gicos protejan la seguridad y los derechos individuales</p></td>
<td><p>ABC</p></td>
<td><p>Neutral</p></td>
<td><p>0.73806867</p></td>
<td><p>0.1435076594</p></td>
<td><p>0.73806867</p></td>
</tr>
<tr class="row-odd"><td><p>2024-01-16</p></td>
<td><p>El Gobierno delega en las autonom√≠as la ampliaci√≥n del bono joven de alquiler</p></td>
<td><p>ABC</p></td>
<td><p>Neutral</p></td>
<td><p>0.7266298234</p></td>
<td><p>0.1628957987</p></td>
<td><p>0.7266298234</p></td>
</tr>
<tr class="row-even"><td><p>2024-01-30</p></td>
<td><p>Reyn√©s (Naturgy) elogia a BlackRock por dar estabilidad a las empresas y ve ¬´alineamiento de intereses¬ª</p></td>
<td><p>ABC</p></td>
<td><p>Neutral</p></td>
<td><p>0.4201913178</p></td>
<td><p>0.3785941601</p></td>
<td><p>0.4201913178</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="analisis-de-frontera-de-eficiencia">
<h2>Analisis de Frontera de eficiencia<a class="headerlink" href="#analisis-de-frontera-de-eficiencia" title="Link to this heading">ÔÉÅ</a></h2>
<p>Para la selecci√≥n de nuestra cartera emplearemos el modelo de media-varianza de Markowitz, considerado la base de la Teor√≠a Moderna de Carteras. Este enfoque es ampliamente utilizado en finanzas porque permite encontrar la combinaci√≥n √≥ptima de activos equilibrando riesgo y rendimiento esperado.
El procedimiento consiste en simular 50.000 carteras aleatorias con diferentes ponderaciones de activos. Posteriormente, se identifican aquellas que cumplen con dos criterios clave:</p>
<ul class="simple">
<li><p>Cartera de m√≠nima varianza: la que presenta el menor nivel de riesgo posible.</p></li>
<li><p>Cartera con ratio de Sharpe m√°ximo: la que ofrece la mejor relaci√≥n entre rendimiento y riesgo ajustado por la tasa libre de riesgo.
<a class="reference internal" href="MarcoTeorico.html#modelo-de-markowitz"><span class="std std-ref">Ir a an√°lisis de cartera</span></a></p></li>
</ul>
<p>El primer aspecto a considerar es que los resultados de nuestro modelo se generan siempre con datos actualizados hasta el d√≠a anterior en todas las bases de datos. Dichos resultados se almacenan en un datalake implementado en Snowflake, el cual se encuentra en constante actualizaci√≥n. Por ello, la primera fase de nuestro an√°lisis consiste en establecer la conexi√≥n con Snowflake y asegurar la correcta creaci√≥n, configuraci√≥n y mantenimiento del datalake.</p>
<p>Una vez completada esta etapa, el modelo se vincula con las acciones seleccionadas por el usuario en funci√≥n de su an√°lisis fundamental ‚Äî[AQU√ç INCLUIR EL NOMBRE DE LA SECCI√ìN DE AN√ÅLISIS FUNDAMENTAL]‚Äî. Para cada activo elegido, se verifican las tendencias hist√≥ricas y se realizan diferentes simulaciones con variaciones en los porcentajes de asignaci√≥n.</p>
<p>De este modo, el modelo permite seleccionar la combinaci√≥n m√°s eficiente considerando no solo los criterios de diversificaci√≥n cuantitativa, sino tambi√©n el an√°lisis fundamental, el an√°lisis descriptivo de los datos hist√≥ricos y el an√°lisis de sentimiento obtenido a partir de noticias sectoriales e industriales.</p>
<p>El c√°lculo de los rendimientos de los activos es una etapa fundamental previa a cualquier an√°lisis de carteras. A partir de los precios hist√≥ricos, se obtienen las variaciones porcentuales que reflejan c√≥mo evoluciona el valor de cada activo en el tiempo.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="linenos">  2</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos">  3</span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="linenos">  4</span><span class="kn">import</span><span class="w"> </span><span class="nn">snowflake.connector</span>
<span class="linenos">  5</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span> 
<span class="linenos">  6</span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="linenos">  7</span><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="linenos">  8</span><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.express</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">px</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="c1"># ================================</span>
<span class="linenos"> 11</span><span class="c1"># Conexi√≥n a Snowflake</span>
<span class="linenos"> 12</span><span class="c1"># ================================</span>
<span class="linenos"> 13</span><span class="n">conn</span> <span class="o">=</span> <span class="n">snowflake</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<span class="linenos"> 14</span>    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;TFMGRUPO4&#39;</span><span class="p">,</span>
<span class="linenos"> 15</span>    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;TFMgrupo4ucm01_01#&#39;</span><span class="p">,</span>
<span class="linenos"> 16</span>    <span class="n">account</span><span class="o">=</span><span class="s1">&#39;WYNIFVB-YE01854&#39;</span><span class="p">,</span>
<span class="linenos"> 17</span>    <span class="n">warehouse</span><span class="o">=</span><span class="s1">&#39;COMPUTE_WH&#39;</span><span class="p">,</span>
<span class="linenos"> 18</span>    <span class="n">database</span><span class="o">=</span><span class="s1">&#39;YAHOO_PRUEBA&#39;</span><span class="p">,</span>   <span class="c1"># &lt;--- ya ajustado</span>
<span class="linenos"> 19</span>    <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;IBEX&#39;</span><span class="p">,</span>             <span class="c1"># &lt;--- ya ajustado</span>
<span class="linenos"> 20</span>    <span class="n">role</span><span class="o">=</span><span class="s1">&#39;ACCOUNTADMIN&#39;</span>
<span class="linenos"> 21</span><span class="p">)</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="c1"># ================================</span>
<span class="linenos"> 24</span><span class="c1"># Tickers y fechas</span>
<span class="linenos"> 25</span><span class="c1"># ================================</span>
<span class="linenos"> 26</span><span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 27</span>    <span class="s2">&quot;IBE.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;ITX.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;TEF.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;BBVA.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;SAN.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;REP.MC&quot;</span><span class="p">,</span>
<span class="linenos"> 28</span>    <span class="s2">&quot;AENA.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;IAG.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;ENG.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;ACS.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;FER.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;CABK.MC&quot;</span><span class="p">,</span>
<span class="linenos"> 29</span>    <span class="s2">&quot;ELE.MC&quot;</span><span class="p">,</span> <span class="s2">&quot;MAP.MC&quot;</span>
<span class="linenos"> 30</span><span class="p">]</span>
<span class="linenos"> 31</span><span class="n">fecha_inicio</span> <span class="o">=</span> <span class="s2">&quot;2020-01-01&quot;</span>
<span class="linenos"> 32</span><span class="n">fecha_fin</span>    <span class="o">=</span> <span class="s2">&quot;2024-12-31&quot;</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span><span class="c1"># ================================</span>
<span class="linenos"> 35</span><span class="c1"># Query de datos</span>
<span class="linenos"> 36</span><span class="c1"># ================================</span>
<span class="linenos"> 37</span><span class="n">quoted_tickers</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">])</span>
<span class="linenos"> 38</span><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="linenos"> 39</span><span class="s2">SELECT TICKER, FECHA, CLOSE</span>
<span class="linenos"> 40</span><span class="s2">FROM TICKERS_INDEX</span>
<span class="linenos"> 41</span><span class="s2">WHERE TICKER IN (</span><span class="si">{</span><span class="n">quoted_tickers</span><span class="si">}</span><span class="s2">)</span>
<span class="linenos"> 42</span><span class="s2">  AND FECHA BETWEEN &#39;</span><span class="si">{</span><span class="n">fecha_inicio</span><span class="si">}</span><span class="s2">&#39; AND &#39;</span><span class="si">{</span><span class="n">fecha_fin</span><span class="si">}</span><span class="s2">&#39;</span>
<span class="linenos"> 43</span><span class="s2">  AND CLOSE IS NOT NULL</span>
<span class="linenos"> 44</span><span class="s2">ORDER BY FECHA, TICKER</span>
<span class="linenos"> 45</span><span class="s2">&quot;&quot;&quot;</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos"> 48</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="linenos"> 49</span><span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
<span class="linenos"> 50</span><span class="n">df_prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
<span class="linenos"> 51</span><span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos"> 52</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span><span class="n">df_prices</span><span class="p">[</span><span class="s1">&#39;CLOSE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_prices</span><span class="p">[</span><span class="s1">&#39;CLOSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="linenos"> 55</span><span class="n">df_prices</span><span class="p">[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_prices</span><span class="p">[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">])</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="n">prices</span> <span class="o">=</span> <span class="n">df_prices</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;FECHA&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;TICKER&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;CLOSE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span><span class="c1"># ================================</span>
<span class="linenos"> 60</span><span class="c1"># C√°lculo de rendimientos</span>
<span class="linenos"> 61</span><span class="c1"># ================================</span>
<span class="linenos"> 62</span><span class="c1"># --8&lt;-- [start:rendimientos]</span>
<span class="linenos"> 63</span><span class="n">rendimientos</span> <span class="o">=</span> <span class="p">(</span><span class="n">prices</span> <span class="o">-</span> <span class="n">prices</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">prices</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 64</span><span class="c1"># --8&lt;-- [end:rendimientos]</span>
<span class="linenos"> 65</span><span class="n">numero_activos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rendimientos</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span><span class="n">rendimientos_portafolio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 68</span><span class="n">riesgo_portafolio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 69</span><span class="n">peso_portafolio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="c1"># --8&lt;-- [start:iteracioncarteras]</span>
<span class="linenos"> 72</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50000</span><span class="p">):</span>
<span class="linenos"> 73</span>    <span class="n">pesos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">numero_activos</span><span class="p">)</span>
<span class="linenos"> 74</span>    <span class="n">pesos</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pesos</span><span class="p">)</span>
<span class="linenos"> 75</span>    <span class="n">rendimiento</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pesos</span> <span class="o">*</span> <span class="n">rendimientos</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">*</span> <span class="mi">252</span>
<span class="linenos"> 76</span>    <span class="n">riesgo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pesos</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rendimientos</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span> <span class="o">*</span> <span class="mi">252</span><span class="p">,</span> <span class="n">pesos</span><span class="p">)))</span>
<span class="linenos"> 77</span>    <span class="n">rendimientos_portafolio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rendimiento</span><span class="p">)</span>
<span class="linenos"> 78</span>    <span class="n">riesgo_portafolio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">riesgo</span><span class="p">)</span>
<span class="linenos"> 79</span>    <span class="n">peso_portafolio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pesos</span><span class="p">)</span>
<span class="linenos"> 80</span><span class="c1"># --8&lt;-- [end:iteracioncarteras]</span>
<span class="linenos"> 81</span><span class="c1"># ================================</span>
<span class="linenos"> 82</span><span class="c1"># Matriz de portafolios</span>
<span class="linenos"> 83</span><span class="c1"># ================================</span>
<span class="linenos"> 84</span><span class="n">portafolios</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 85</span>    <span class="s1">&#39;Rendimientos&#39;</span><span class="p">:</span> <span class="n">rendimientos_portafolio</span><span class="p">,</span>
<span class="linenos"> 86</span>    <span class="s1">&#39;Riesgos&#39;</span><span class="p">:</span> <span class="n">riesgo_portafolio</span><span class="p">,</span>
<span class="linenos"> 87</span><span class="p">}</span>
<span class="linenos"> 88</span><span class="k">for</span> <span class="n">contador</span><span class="p">,</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rendimientos</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
<span class="linenos"> 89</span>    <span class="n">portafolios</span><span class="p">[</span><span class="s2">&quot;Peso&quot;</span> <span class="o">+</span> <span class="n">ticker</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">W</span><span class="p">[</span><span class="n">contador</span><span class="p">]</span> <span class="k">for</span> <span class="n">W</span> <span class="ow">in</span> <span class="n">peso_portafolio</span><span class="p">]</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="n">Matriz_portafolios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">portafolios</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="c1"># ================================</span>
<span class="linenos"> 94</span><span class="c1"># Portafolios destacados</span>
<span class="linenos"> 95</span><span class="c1"># ================================</span>
<span class="linenos"> 96</span><span class="n">varianza_minima</span> <span class="o">=</span> <span class="n">Matriz_portafolios</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">Matriz_portafolios</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span><span class="n">risk_free</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="linenos"> 99</span><span class="n">portafolio_optimo</span> <span class="o">=</span> <span class="n">Matriz_portafolios</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
<span class="linenos">100</span>    <span class="p">((</span><span class="n">Matriz_portafolios</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">risk_free</span><span class="p">)</span> <span class="o">/</span> <span class="n">Matriz_portafolios</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="linenos">101</span><span class="p">]</span>
<span class="linenos">102</span>
<span class="linenos">103</span><span class="c1"># ================================</span>
<span class="linenos">104</span><span class="c1"># Funciones auxiliares</span>
<span class="linenos">105</span><span class="c1"># ================================</span>
<span class="linenos">106</span><span class="k">def</span><span class="w"> </span><span class="nf">crear_info_composicion</span><span class="p">(</span><span class="n">row_index</span><span class="p">):</span>
<span class="linenos">107</span>    <span class="n">composicion</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">108</span>    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">rendimientos</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<span class="linenos">109</span>        <span class="n">peso_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Peso</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">110</span>        <span class="n">peso</span> <span class="o">=</span> <span class="n">Matriz_portafolios</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">peso_col</span><span class="p">]</span>
<span class="linenos">111</span>        <span class="k">if</span> <span class="n">peso</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># &gt;1%</span>
<span class="linenos">112</span>            <span class="n">composicion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">peso</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">113</span>    <span class="k">return</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">composicion</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
<span class="linenos">114</span>
<span class="linenos">115</span><span class="k">def</span><span class="w"> </span><span class="nf">crear_composicion_detallada</span><span class="p">(</span><span class="n">portafolio</span><span class="p">):</span>
<span class="linenos">116</span>    <span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">117</span>    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">rendimientos</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<span class="linenos">118</span>        <span class="n">peso_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Peso</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">119</span>        <span class="n">peso</span> <span class="o">=</span> <span class="n">portafolio</span><span class="p">[</span><span class="n">peso_col</span><span class="p">]</span>
<span class="linenos">120</span>        <span class="k">if</span> <span class="n">peso</span> <span class="o">&gt;</span> <span class="mf">0.005</span><span class="p">:</span>  <span class="c1"># &gt;0.5%</span>
<span class="linenos">121</span>            <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">peso</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">122</span>    <span class="k">return</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
<span class="linenos">123</span>
<span class="linenos">124</span><span class="c1"># ================================</span>
<span class="linenos">125</span><span class="c1"># Gr√°fico frontera de eficiencia</span>
<span class="linenos">126</span><span class="c1"># ================================</span>
<span class="linenos">127</span><span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="linenos">128</span>
<span class="linenos">129</span><span class="c1"># Scatter de todos los portafolios</span>
<span class="linenos">130</span><span class="n">customdata_info</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">131</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Matriz_portafolios</span><span class="p">)):</span>
<span class="linenos">132</span>    <span class="n">sharpe</span> <span class="o">=</span> <span class="p">(</span><span class="n">Matriz_portafolios</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">risk_free</span><span class="p">)</span> <span class="o">/</span> <span class="n">Matriz_portafolios</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">]</span>
<span class="linenos">133</span>    <span class="n">composicion</span> <span class="o">=</span> <span class="n">crear_info_composicion</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">134</span>    <span class="n">customdata_info</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">sharpe</span><span class="p">,</span> <span class="n">composicion</span><span class="p">])</span>
<span class="linenos">135</span>
<span class="linenos">136</span><span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
<span class="linenos">137</span>    <span class="n">x</span><span class="o">=</span><span class="n">Matriz_portafolios</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">],</span>
<span class="linenos">138</span>    <span class="n">y</span><span class="o">=</span><span class="n">Matriz_portafolios</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">],</span>
<span class="linenos">139</span>    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span>
<span class="linenos">140</span>    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Matriz_portafolios</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<span class="linenos">141</span>                <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Rendimiento&lt;br&gt;Esperado&quot;</span><span class="p">,</span> <span class="n">titleside</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)),</span>
<span class="linenos">142</span>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Portafolios simulados&#39;</span><span class="p">,</span>
<span class="linenos">143</span>    <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;üìä Portafolio Simulado&lt;/b&gt;&lt;br&gt;&#39;</span>
<span class="linenos">144</span>                  <span class="s1">&#39;&lt;b&gt;Riesgo:&lt;/b&gt; %</span><span class="si">{x:.3f}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">145</span>                  <span class="s1">&#39;&lt;b&gt;Rendimiento:&lt;/b&gt; %</span><span class="si">{y:.3f}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">146</span>                  <span class="s1">&#39;&lt;b&gt;Ratio Sharpe:&lt;/b&gt; %</span><span class="si">{customdata[0]:.3f}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">147</span>                  <span class="s1">&#39;&lt;br&gt;&lt;b&gt;üíº Composici√≥n del Portafolio:&lt;/b&gt;&lt;br&gt;&#39;</span>
<span class="linenos">148</span>                  <span class="s1">&#39;%</span><span class="si">{customdata[1]}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">149</span>                  <span class="s1">&#39;&lt;extra&gt;&lt;/extra&gt;&#39;</span><span class="p">,</span>
<span class="linenos">150</span>    <span class="n">customdata</span><span class="o">=</span><span class="n">customdata_info</span>
<span class="linenos">151</span><span class="p">))</span>
<span class="linenos">152</span>
<span class="linenos">153</span><span class="c1"># M√≠nima varianza</span>
<span class="linenos">154</span><span class="n">composicion_mv</span> <span class="o">=</span> <span class="n">crear_composicion_detallada</span><span class="p">(</span><span class="n">varianza_minima</span><span class="p">)</span>
<span class="linenos">155</span><span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
<span class="linenos">156</span>    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">varianza_minima</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">]],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">varianza_minima</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">]],</span>
<span class="linenos">157</span>    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;star&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
<span class="linenos">158</span>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M√≠nima varianza&#39;</span><span class="p">,</span>
<span class="linenos">159</span>    <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;üåü Portafolio de M√≠nima Varianza&lt;/b&gt;&lt;br&gt;&#39;</span>
<span class="linenos">160</span>                  <span class="s1">&#39;&lt;b&gt;Riesgo:&lt;/b&gt; %</span><span class="si">{x:.4f}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">161</span>                  <span class="s1">&#39;&lt;b&gt;Rendimiento:&lt;/b&gt; %</span><span class="si">{y:.4f}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">162</span>                  <span class="s1">&#39;&lt;br&gt;&lt;b&gt;üíº Composici√≥n del Portafolio:&lt;/b&gt;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">composicion_mv</span><span class="si">}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">163</span>                  <span class="s1">&#39;&lt;extra&gt;&lt;/extra&gt;&#39;</span>
<span class="linenos">164</span><span class="p">))</span>
<span class="linenos">165</span>
<span class="linenos">166</span><span class="c1"># Sharpe m√°ximo</span>
<span class="linenos">167</span><span class="n">sharpe_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">portafolio_optimo</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">risk_free</span><span class="p">)</span> <span class="o">/</span> <span class="n">portafolio_optimo</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">]</span>
<span class="linenos">168</span><span class="n">composicion_opt</span> <span class="o">=</span> <span class="n">crear_composicion_detallada</span><span class="p">(</span><span class="n">portafolio_optimo</span><span class="p">)</span>
<span class="linenos">169</span><span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
<span class="linenos">170</span>    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">portafolio_optimo</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">]],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">portafolio_optimo</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">]],</span>
<span class="linenos">171</span>    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;star&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
<span class="linenos">172</span>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sharpe m√°ximo&#39;</span><span class="p">,</span>
<span class="linenos">173</span>    <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;üéØ Portafolio √ìptimo (Sharpe m√°ximo)&lt;/b&gt;&lt;br&gt;&#39;</span>
<span class="linenos">174</span>                  <span class="s1">&#39;&lt;b&gt;Riesgo:&lt;/b&gt; %</span><span class="si">{x:.4f}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">175</span>                  <span class="s1">&#39;&lt;b&gt;Rendimiento:&lt;/b&gt; %</span><span class="si">{y:.4f}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">176</span>                  <span class="sa">f</span><span class="s1">&#39;&lt;b&gt;Ratio Sharpe:&lt;/b&gt; </span><span class="si">{</span><span class="n">sharpe_ratio</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">177</span>                  <span class="s1">&#39;&lt;br&gt;&lt;b&gt;üíº Composici√≥n del Portafolio:&lt;/b&gt;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">composicion_opt</span><span class="si">}</span><span class="s1">&lt;br&gt;&#39;</span>
<span class="linenos">178</span>                  <span class="s1">&#39;&lt;extra&gt;&lt;/extra&gt;&#39;</span>
<span class="linenos">179</span><span class="p">))</span>
<span class="linenos">180</span>
<span class="linenos">181</span><span class="c1"># Layout</span>
<span class="linenos">182</span><span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<span class="linenos">183</span>    <span class="n">title</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;üìà Frontera de Eficiencia - Portafolios IBEX 35&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="linenos">184</span>               <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)),</span>
<span class="linenos">185</span>    <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Riesgo (Volatilidad)&#39;</span><span class="p">,</span> <span class="n">titlefont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span> <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="linenos">186</span>               <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">gridwidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="linenos">187</span>    <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rendimiento Esperado&#39;</span><span class="p">,</span> <span class="n">titlefont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span> <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="linenos">188</span>               <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">gridwidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="linenos">189</span>    <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
<span class="linenos">190</span>    <span class="n">hovermode</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">191</span>    <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;rgba(255,255,255,0.9)&#39;</span><span class="p">,</span> <span class="n">bordercolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="linenos">192</span><span class="p">)</span>
<span class="linenos">193</span>
<span class="linenos">194</span><span class="c1"># Anotaciones</span>
<span class="linenos">195</span><span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">varianza_minima</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">varianza_minima</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">],</span>
<span class="linenos">196</span>                   <span class="n">text</span><span class="o">=</span><span class="s2">&quot;üåü M√≠nima&lt;br&gt;Varianza&quot;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arrowsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">197</span>                   <span class="n">arrowwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arrowcolor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ay</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">))</span>
<span class="linenos">198</span>
<span class="linenos">199</span><span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">portafolio_optimo</span><span class="p">[</span><span class="s1">&#39;Riesgos&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">portafolio_optimo</span><span class="p">[</span><span class="s1">&#39;Rendimientos&#39;</span><span class="p">],</span>
<span class="linenos">200</span>                   <span class="n">text</span><span class="o">=</span><span class="s2">&quot;üéØ Sharpe&lt;br&gt;M√°ximo&quot;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arrowsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">201</span>                   <span class="n">arrowwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arrowcolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ay</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">))</span>
<span class="linenos">202</span>
<span class="linenos">203</span><span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Luego</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de p√°gina">
        <a href="DatosPreparacion.html" class="btn btn-neutral float-left" title="Datos y Preparaci√≥n" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="EvaluacionModelo.html" class="btn btn-neutral float-right" title="Evaluaci√≥n de los Modelos" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2025, Julia Escudero, Marco Mendieta, Marco Pacora, Piero Rios, Juan Carlos Romero.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>